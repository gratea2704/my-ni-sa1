<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>à¸ªà¸²à¸£à¸ à¸²à¸à¹ƒà¸ˆ</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:'Segoe UI',Tahoma;
background:linear-gradient(135deg,#667eea,#764ba2);
min-height:100vh;
display:flex;justify-content:center;align-items:center;padding:20px
}
.container{
background:#fff;border-radius:20px;
max-width:600px;width:100%;
padding:30px;box-shadow:0 20px 40px rgba(0,0,0,.15)
}
h1{text-align:center;margin-bottom:10px}
.stats{text-align:center;margin-bottom:20px}
.form-group{margin-bottom:15px}
textarea,select,input{
width:100%;padding:10px;border-radius:10px;
border:2px solid #ddd;font-size:16px
}
button{
padding:10px 20px;border:none;border-radius:20px;
background:#667eea;color:white;cursor:pointer
}
.confession-item{
background:#f7f7f7;padding:15px;border-radius:15px;
margin-top:15px;border-left:5px solid #667eea
}
.meta{display:flex;justify-content:space-between;font-size:14px;color:#666}
.actions{margin-top:10px;display:flex;gap:10px}
.comment{
background:#eee;padding:8px;border-radius:10px;
margin-top:5px;font-size:14px
}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ’­ à¸ªà¸²à¸£à¸ à¸²à¸à¹ƒà¸ˆ</h1>
  <p style="text-align:center;margin-bottom:15px">à¹„à¸¡à¹ˆà¹€à¸›à¸´à¸”à¹€à¸œà¸¢à¸•à¸±à¸§à¸•à¸™</p>

  <div class="stats">
    à¸¡à¸µà¸à¸²à¸£à¸ªà¸²à¸£à¸ à¸²à¸à¹à¸¥à¹‰à¸§ <b id="count">0</b> à¸„à¸£à¸±à¹‰à¸‡
  </div>

  <form id="form">
    <div class="form-group">
      <select id="category" required>
        <option value="">à¹€à¸¥à¸·à¸­à¸à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ</option>
        <option value="à¸„à¸§à¸²à¸¡à¸£à¸±à¸">ğŸ’• à¸„à¸§à¸²à¸¡à¸£à¸±à¸</option>
        <option value="à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ à¸„à¸£à¸­à¸šà¸„à¸£à¸±à¸§</option>
        <option value="à¹€à¸à¸·à¹ˆà¸­à¸™">ğŸ‘« à¹€à¸à¸·à¹ˆà¸­à¸™</option>
        <option value="à¸„à¸§à¸²à¸¡à¸¥à¸±à¸š">ğŸ¤« à¸„à¸§à¸²à¸¡à¸¥à¸±à¸š</option>
      </select>
    </div>
    <div class="form-group">
      <textarea id="text" placeholder="à¸à¸´à¸¡à¸à¹Œà¸„à¸§à¸²à¸¡à¹ƒà¸™à¹ƒà¸ˆ..." required></textarea>
    </div>
    <button>ğŸš€ à¸ªà¹ˆà¸‡à¸ªà¸²à¸£à¸ à¸²à¸</button>
  </form>

  <div id="list"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”´ à¹ƒà¸ªà¹ˆ firebaseConfig à¸‚à¸­à¸‡à¸„à¸¸à¸“ */
const firebaseConfig = {
  apiKey: "XXXX",
  authDomain: "XXXX",
  projectId: "XXXX",
  storageBucket: "XXXX",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===== util ===== */
function anon(){
 const a=['à¸¥à¸¶à¸à¸¥à¸±à¸š','à¸à¸±à¸™à¸”à¸µ','à¹€à¸¨à¸£à¹‰à¸²','à¸«à¸§à¸²à¸™','à¹€à¸‡à¸µà¸¢à¸š'];
 const b=['à¸”à¸²à¸§','à¸™à¸','à¸Ÿà¹‰à¸²','à¹ƒà¸ˆ','à¹€à¸‡à¸²'];
 return a[Math.floor(Math.random()*5)] +
        b[Math.floor(Math.random()*5)] +
        Math.floor(Math.random()*999);
}

/* ===== submit ===== */
form.addEventListener("submit", async e=>{
 e.preventDefault();
 await db.collection("confessions").add({
   text:text.value,
   category:category.value,
   anonymousId:anon(),
   likes:0,
   comments:[],
   createdAt:firebase.firestore.FieldValue.serverTimestamp()
 });
 text.value=""; category.value="";
});

/* ===== realtime ===== */
db.collection("confessions")
.orderBy("createdAt","desc")
.onSnapshot(snap=>{
 count.textContent=snap.size;
 list.innerHTML="";
 snap.forEach(doc=>{
   const d=doc.data();
   list.innerHTML+=`
   <div class="confession-item">
     <div class="meta">
       <span>ğŸ‘¤ ${d.anonymousId}</span>
       <span>${d.category}</span>
     </div>

     <p style="margin-top:8px">${d.text}</p>

     <div class="actions">
       <button onclick="like('${doc.id}',${d.likes})">â¤ï¸ ${d.likes}</button>
       <button onclick="showComment('${doc.id}')">ğŸ’¬ ${d.comments.length}</button>
     </div>

     <div id="c-${doc.id}" style="display:none">
       <input id="i-${doc.id}" placeholder="à¸„à¸­à¸¡à¹€à¸¡à¸™à¸•à¹Œ">
       <button onclick="comment('${doc.id}')">à¸ªà¹ˆà¸‡</button>
       ${d.comments.map(c=>`<div class="comment">ğŸ’¬ ${c}</div>`).join("")}
     </div>
   </div>`;
 });
});

/* ===== like ===== */
function like(id,likes){
 db.collection("confessions").doc(id).update({
   likes:likes+1
 });
}

/* ===== comment ===== */
function showComment(id){
 const el=document.getElementById("c-"+id);
 el.style.display=el.style.display==="none"?"block":"none";
}

function comment(id){
 const input=document.getElementById("i-"+id);
 if(!input.value.trim())return;
 db.collection("confessions").doc(id).update({
   comments:firebase.firestore.FieldValue.arrayUnion(input.value)
 });
 input.value="";
}
</script>
</body>
</html>

